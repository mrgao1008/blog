<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Seite 2 | Mrgao1008&#39;s blog</title>
  <meta name="author" content="mrgao1008@gmail.com">
  
  <meta name="description" content="Some documents when reading books">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Mrgao1008&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/blog/favicon.png" rel="icon">
  <link rel="alternate" href="/blog/atom.xml" title="Mrgao1008&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/blog/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/blog/">Mrgao1008&#39;s blog</a></h1>
  <h2><a href="/blog/">technology documents</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/blog/">Home</a></li>
    
      <li><a href="/blog/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-01T07:43:47.743Z"><a href="/blog/2016/04/01/如何给Linux kernel提交代码/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/如何给Linux kernel提交代码/"></a></h1>
  

    </header>
    <div class="entry">
      
        <p>#如何给Linux Kernel提交代码</p>
<p><strong><a href="http://kernelnewbies.org/UpstreamMerge/SubmittingPatches" target="_blank" rel="external">英文</a></strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><span id="前言">前言</span></h2><p>个人或者公司如果不熟悉提交代码流程，代码很难被接受。利用本文给出一些建议将会大大的增加代码被接受的概率。</p>
<p>在提交代码之前，你需要阅读一些注意事项<code>Documentation\SubmitChecklist</code>。如果是提交的驱动，同时也请阅读<code>Documentation\SubmittingDrivers</code>。</p>
<h2 id="创造并提交改动"><a href="#创造并提交改动" class="headerlink" title="创造并提交改动"></a>创造并提交改动</h2><p>###diff -up</p>
<p>利用<code>diff -up</code>或者<code>diff -uprN</code>创造patch文件。</p>
<p>linux所有的更改都以patche方式存在。patch命令中<code>-u</code>代表<code>unified diff</code>,<code>-p</code>会显示哪个函数发生了改变。patche都是以linux源码的根目录为其实点。<br>比如你更改了一个文件。你需要进行下面的操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SRCTREE= linux-2.6</span><br><span class="line">MYFILE= drivers/net/mydriver.c</span><br><span class="line"></span><br><span class="line">cd $SRCTREE</span><br><span class="line">cp $MYFILE $MYFILE.orig</span><br><span class="line">vi $MYFILE       # make your change</span><br><span class="line">cd ..</span><br><span class="line">diff -up $SRCTREE/$MYFILE&#123;.orig,&#125; &gt; /tmp/patch</span><br></pre></td></tr></table></figure></p>
<p>如果更改了多个文件，你需要解压一个<code>vanilla</code>或者原版linux kernel。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MYSRC= /devel/linux-2.6</span><br><span class="line"></span><br><span class="line">tar xvfz linux-2.6.12.tar.gz</span><br><span class="line">mv linux-2.6.12 linux-2.6.12-vanilla</span><br><span class="line">diff -uprN -X linux-2.6.12-vanilla/Documentation/dontdiff \</span><br><span class="line">    linux-2.6.12-vanilla $MYSRC &gt; /tmp/patch</span><br></pre></td></tr></table></figure></p>
<p>其中<code>dontdiff</code>是diff需要忽略的文件列表。</p>
<p>确保patche中不包含其他无关文件。</p>
<p>如果你的更改比较巨大，可以按照逻辑分成几个部分。这方便其他内核开发者审查。</p>
<p>patch管理工具<a href="http://savannah.nongnu.org/projects/quilt" target="_blank" rel="external">Quilt</a>.一些脚本工具<a href="http://userweb.kernel.org/~akpm/stuff/patch-scripts.tar.gz" target="_blank" rel="external">Scripts</a></p>
<p>###描述更改</p>
<p>描述更改过程中的技术细节，做到尽可能清晰。如果描述过长，可能你需要分成几个patch。</p>
<p>###分割更改</p>
<p>按照逻辑分割patch文件。<br>比如，你填补了一个驱动的bug同时还提高了它的性能，那么你需要将他分成多个patche。如果你更改了一个API,并提供一个新的驱动利用了该API，这需要分成2个patch。另一方面，如果你只是更改了很多不同文件的同一个地方，你需要将更改放在同一个patch中。如果你的patch比如依赖另外一个patch，你需要在描述patch时说明<code>this patch depends on patch X</code>。</p>
<p>###检查代码风格</p>
<p>按照<code>Documentation/Codingstyle</code>中的描述，检查更改的编码风格。没有进行这一步的代码可能在甚至没有被阅读情况下被拒绝。最基本的，你可以采用<code>scripts/checkpatch.pl</code>检查patch的编码风格，并且修改所有不恰当的地方。</p>
<p>###选择发送者</p>
<p>linux主线的每一部分都由一个维护者负责。更改属于哪一部分就发给对应的维护者。如果维护者没有列出，或者不回应邮件，你可以将patch发给<code>linux-kernel@vger.kernel.org</code>。</p>
<p>Linus Torvalds是接受更改的仲裁者，但是一般不要给他发邮件。比较明显的bug修复或者不需要讨论的patch可以直接抄送给Linux Torvalds。如果Patch没有明显的优势或者需要讨论，你需要先发给linux-kernel.</p>
<p>###选择抄送人</p>
<p>如果没有特别原因需要抄送给<code>linux-kernel@vger.kernel.org</code>。这样可以让其他开发者可以检查代码和提出意见。</p>
<p>如果你的更改影响了用户和内核接口，请抄送给MAN-PAGES维护者，方便他们做更改。<br>小的更改：比如字符拼写错误等你需要抄送给<code>trivial@kernel.org</code>。<br>比如在文档中的拼写错误等。关于小错误的定义可以查看<a href="http://www.kernel.org/pub/linux/kernel/people/juhl/trivial/" target="_blank" rel="external">trivial</a>。</p>
<p>###只允许文字（没有多媒体，链接，压缩，附件）</p>
<p>所以patch都写在邮件中。</p>
<p>###email的大小</p>
<p>email的大小如果超过40kb，你需要放到网络上，并提供链接。</p>
<p>###指明kernel版本</p>
<p>你需要指明patch的kernel版本，如果patch不适用于最新的kernel，linus不会接受。</p>
<p>###别沮丧，重新提交</p>
<p>提交更改后，需要耐心等待。如果更改没有出现在下一个版本中，那么可能是一下原因：</p>
<ul>
<li>更改不适用于最新内核版本</li>
<li>更改没有经过足够讨论</li>
<li>代码风格问题</li>
<li>e-mail格式问题</li>
<li>更改存在技术问题</li>
<li>意外丢失</li>
<li>你太烦了</li>
</ul>
<p>如果有疑问，可以在linux-kernel邮件列表上询问。</p>
<p>###在邮件主题上加上[PATCH]</p>
<p>###签名</p>
<p>为了方便跟踪作者和管理复杂的更改，引入了签名机制。如果确认一下4点就可以在对patch的描述后加上一句：<br>Signed-off-by: Random J Developer <a href="&#109;&#x61;&#105;&#x6c;&#x74;&#x6f;&#58;&#x72;&#x61;&#110;&#100;&#x6f;&#x6d;&#64;&#x64;&#x65;&#118;&#x65;&#108;&#111;&#x70;&#x65;&#114;&#46;&#x65;&#120;&#x61;&#109;&#x70;&#108;&#x65;&#46;&#111;&#x72;&#x67;">&#x72;&#x61;&#110;&#100;&#x6f;&#x6d;&#64;&#x64;&#x65;&#118;&#x65;&#108;&#111;&#x70;&#x65;&#114;&#46;&#x65;&#120;&#x61;&#109;&#x70;&#108;&#x65;&#46;&#111;&#x72;&#x67;</a></p>
<ul>
<li>更改部分或者全部由我完成。我有权利开源</li>
<li>更改基于一个开源项目，需提交到同一个开源license下。否则可以提交给别的开源license</li>
<li>更改由别人转交给我，别人确认1,2,3条，我没有修改更改</li>
<li>我知道这是一个开源项目，并且贡献有可能不被记录</li>
</ul>
<p>###Acked-by</p>
<p>子系统的维护者需要这么做，表示patch你觉得还不错。</p>
<p>###Tested-by和Reviewed-by</p>
<p>Tested-by表示某人在某种环境下patch测试是有效的。<br>Reviewed-by表示这个patch被检查，说明你对patch的观点。</p>
<p>###patch的规范格式</p>
<p>主题：[PATCH 001/123] 子系统: 总结</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from:</span><br><span class="line">空行</span><br><span class="line">patch的描述</span><br><span class="line">Signed-off-by:</span><br><span class="line">标识符---</span><br><span class="line">其他一些评论</span><br><span class="line">diff output</span><br></pre></td></tr></table></figure>
<p>主题的2个示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Subject: [patch 2/5] ext2: improve scalability of bitmap searching</span><br><span class="line">Subject: [PATCHv2 001/207] x86: fix eflags tracking</span><br></pre></td></tr></table></figure></p>
<p>from行的示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">From: Original Author &lt;author@example.com&gt;</span><br></pre></td></tr></table></figure></p>
<p>—表示改动日志的结束。<br>其他一些评论可以用来写上<code>diffstat -p 1 -w 70</code>。</p>
<p>###发送git pull请求</p>
<p>发送从哪能够获得更改，格式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Please pull from</span><br><span class="line">        git://jdelvare.pck.nerim.net/jdelvare-2.6 i2c-for-linus</span><br><span class="line"> to get these changes:</span><br></pre></td></tr></table></figure></p>
<p>同时用<code>git diff -M --stat --summary</code>生成diffstat.</p>
<h2 id="忠告、建议、技巧"><a href="#忠告、建议、技巧" class="headerlink" title="忠告、建议、技巧"></a>忠告、建议、技巧</h2><ul>
<li><p>阅读Documentation/CodingStyle</p>
<p>  可以利用scripts/checkpatch.pl来检查代码风格。这个脚本会提供3种水平的忠告</p>
<ul>
<li>ERROR: 很可能有错</li>
<li>WARNING: 需要认真检查</li>
<li>CHECK：需要考虑</li>
</ul>
</li>
<li><p>不要在函数内使用ifdef。<br>  例如：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dev = alloc_etherdev (sizeof(struct funky_private));</span><br><span class="line">if (!dev)</span><br><span class="line">        return -ENODEV;</span><br><span class="line">#ifdef CONFIG_NET_FUNKINESS</span><br><span class="line">init_funky_net(dev);</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>  上面的可以更改为</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(in header)</span><br><span class="line">    #ifndef CONFIG_NET_FUNKINESS</span><br><span class="line">    static inline void init_funky_net (struct net_device *d) &#123;&#125;</span><br><span class="line">    #endif</span><br><span class="line">(in the code itself)</span><br><span class="line">    dev = alloc_etherdev (sizeof(struct funky_private));</span><br><span class="line">    if (!dev)</span><br><span class="line">            return -ENODEV;</span><br><span class="line">    init_funky_net(dev);</span><br></pre></td></tr></table></figure>
</li>
<li><p>static inline 比宏更好</p>
</li>
<li><p>不要过度设计</p>
<p>  Make it as simple as you can, and no simpler.</p>
</li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>这篇文章翻译于<a href="http://kernelnewbies.org/UpstreamMerge/SubmittingPatches" target="_blank" rel="external">英文原稿</a>.</p>
<p><a href="#前言">回到顶部</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-01T07:43:47.743Z"><a href="/blog/2016/04/01/libvmi介绍/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/libvmi介绍/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="libvmi介绍"><a href="#libvmi介绍" class="headerlink" title="libvmi介绍"></a>libvmi介绍</h1><p>libvmi提供了大量的库函数用于开发基于VMI的安全软件。</p>
<h2 id="libvmi的接口"><a href="#libvmi的接口" class="headerlink" title="libvmi的接口"></a>libvmi的接口</h2><ol>
<li>VMI构造和析构</li>
<li>VM基本信息获取</li>
<li>VM地址转换、pid页表转换</li>
<li>VM读写内存</li>
<li>VMIcache操作函数</li>
<li>事件注册通知</li>
</ol>
<h3 id="VMI构造和析构"><a href="#VMI构造和析构" class="headerlink" title="VMI构造和析构"></a>VMI构造和析构</h3><p>接口包括下面这些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vmi_init</span><br><span class="line">vmi_init_custom</span><br><span class="line">vmi_init_complete</span><br><span class="line">vmi_init_complete_custom</span><br><span class="line">vmi_init_paging</span><br><span class="line">vmi_destroy</span><br></pre></td></tr></table></figure>
<p>带有custom表示从内存结构中读取配置，否则从文件中读取配置。<br>complete用在vmi_init中以partial方式初始化后（这种状态下只提供物理地址读写），经过启发式方法确定了特别偏移量后，进行完全初始化，这样才能够用其他方式比如符号、虚拟地址读写。</p>
<h3 id="VM基本信息获取"><a href="#VM基本信息获取" class="headerlink" title="VM基本信息获取"></a>VM基本信息获取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vmi_get_name -&gt;driver_get_name</span><br><span class="line">vmi_get_vmid -&gt;driver_get_id</span><br><span class="line">vmi_get_access_mode //xen kvm file</span><br><span class="line">vmi_get_page_mode</span><br><span class="line">vmi_get_address_width</span><br><span class="line">vmi_get_ostype</span><br><span class="line">vmi_get_winver</span><br><span class="line">vmi_get_winver_str</span><br><span class="line">vmi_get_winver_manual</span><br><span class="line">vmi_get_offset</span><br><span class="line">vmi_get_memsize</span><br></pre></td></tr></table></figure>
<p>windows能够设置和得到的符号包括如下表</p>
<table>
<thead>
<tr>
<th>符号名字</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>win_ntoskrnl</td>
<td></td>
</tr>
<tr>
<td>win_tasks</td>
<td></td>
</tr>
<tr>
<td>win_pdbase</td>
<td></td>
</tr>
<tr>
<td>win_pid</td>
<td></td>
</tr>
<tr>
<td>win_pname</td>
<td></td>
</tr>
<tr>
<td>win_kdvb</td>
<td></td>
</tr>
<tr>
<td>win_sysproc</td>
<td></td>
</tr>
<tr>
<td>win_kpcr</td>
<td></td>
</tr>
<tr>
<td>win_kdbg</td>
<td></td>
</tr>
<tr>
<td>ostype<br>os_type</td>
<td></td>
</tr>
<tr>
<td>sysmap</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td></td>
</tr>
<tr>
<td>domid</td>
</tr>
</tbody>
</table>
<h3 id="VM地址转换、pid页表转换"><a href="#VM地址转换、pid页表转换" class="headerlink" title="VM地址转换、pid页表转换"></a>VM地址转换、pid页表转换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vmi_translate_kv2p</span><br><span class="line">vmi_translate_uv2p</span><br><span class="line">vmi_translate_ksym2v</span><br><span class="line">vmi_translate_sym2v  //遍历PE导出表</span><br><span class="line">vmi_translate_v2sym</span><br><span class="line">vmi_pid_to_dtb</span><br><span class="line">vmi_dtb_to_pid</span><br><span class="line">vmi_pagetable_lookup //虚拟地址转化为物理地址</span><br><span class="line">vmi_pagetable_lookup_extended</span><br></pre></td></tr></table></figure>
<h3 id="VM读写内存"><a href="#VM读写内存" class="headerlink" title="VM读写内存"></a>VM读写内存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vmi_read(write)</span><br><span class="line">vmi_read(write)_a_b //a=[8,16,32,64,addr,str],b=[pa,va,ksym]</span><br><span class="line">vmi_read_unicode_str_va</span><br><span class="line">vmi_convert_str_encoding</span><br><span class="line">vmi_print_hex_a //a=[pa,va,ksym]</span><br></pre></td></tr></table></figure>
<h3 id="VMIcache操作函数"><a href="#VMIcache操作函数" class="headerlink" title="VMIcache操作函数"></a>VMIcache操作函数</h3><p>v2pcache表示内部虚拟地址到物理地址转换</p>
<p>symcache 符号到虚拟地址转换</p>
<p>rvacache rva到符号的转换</p>
<p>pidcache pid到dtb的转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vmi_a_add //a=[v2pcache,symcache,rvacache,pidcache]</span><br><span class="line">vmi_a_flush //a=[v2pcache,symcache,rvacache,pidcache]</span><br></pre></td></tr></table></figure>
<h3 id="事件注册通知"><a href="#事件注册通知" class="headerlink" title="事件注册通知"></a>事件注册通知</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">static inline status_t</span><br><span class="line">driver_xen_setup(vmi_instance_t vmi)</span><br><span class="line">&#123;</span><br><span class="line">    driver_interface_t driver = &#123; 0 &#125;;</span><br><span class="line">    driver.initialized = true;</span><br><span class="line">    driver.init_ptr = &amp;xen_init;</span><br><span class="line">    driver.init_vmi_ptr = &amp;xen_init_vmi;</span><br><span class="line">    driver.destroy_ptr = &amp;xen_destroy;</span><br><span class="line">    driver.get_id_from_name_ptr = &amp;xen_get_domainid_from_name;</span><br><span class="line">    driver.get_name_from_id_ptr = &amp;xen_get_name_from_domainid;</span><br><span class="line">    driver.get_id_ptr = &amp;xen_get_domainid;</span><br><span class="line">    driver.set_id_ptr = &amp;xen_set_domainid;</span><br><span class="line">    driver.check_id_ptr = &amp;xen_check_domainid;</span><br><span class="line">    driver.get_name_ptr = &amp;xen_get_domainname;</span><br><span class="line">    driver.set_name_ptr = &amp;xen_set_domainname;</span><br><span class="line">    driver.get_memsize_ptr = &amp;xen_get_memsize;</span><br><span class="line">    driver.get_vcpureg_ptr = &amp;xen_get_vcpureg;</span><br><span class="line">    driver.set_vcpureg_ptr = &amp;xen_set_vcpureg;</span><br><span class="line">    driver.get_address_width_ptr = &amp;xen_get_address_width;</span><br><span class="line">    driver.read_page_ptr = &amp;xen_read_page;</span><br><span class="line">    driver.write_ptr = &amp;xen_write;</span><br><span class="line">    driver.is_pv_ptr = &amp;xen_is_pv;</span><br><span class="line">    driver.pause_vm_ptr = &amp;xen_pause_vm;</span><br><span class="line">    driver.resume_vm_ptr = &amp;xen_resume_vm;</span><br><span class="line">#if ENABLE_SHM_SNAPSHOT == 1</span><br><span class="line">    driver.create_shm_snapshot_ptr = &amp;xen_create_shm_snapshot;</span><br><span class="line">    driver.destroy_shm_snapshot_ptr = &amp;xen_destroy_shm_snapshot;</span><br><span class="line">    driver.get_dgpma_ptr = &amp;xen_get_dgpma;</span><br><span class="line">#endif</span><br><span class="line">#if ENABLE_XEN_EVENTS == 1</span><br><span class="line">    driver.events_listen_ptr = &amp;xen_events_listen;</span><br><span class="line">    driver.are_events_pending_ptr = &amp;xen_are_events_pending;</span><br><span class="line">    driver.set_reg_access_ptr = &amp;xen_set_reg_access;</span><br><span class="line">    driver.set_intr_access_ptr = &amp;xen_set_intr_access;</span><br><span class="line">    driver.set_mem_access_ptr = &amp;xen_set_mem_access;</span><br><span class="line">    driver.start_single_step_ptr = &amp;xen_start_single_step;</span><br><span class="line">    driver.stop_single_step_ptr = &amp;xen_stop_single_step;</span><br><span class="line">    driver.shutdown_single_step_ptr = &amp;xen_shutdown_single_step;</span><br><span class="line">#endif</span><br><span class="line">    vmi-&gt;driver = driver;</span><br><span class="line">    return VMI_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-01T07:43:47.743Z"><a href="/blog/2016/04/01/并行计算与分布式计算原理/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/并行计算与分布式计算原理/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="并行计算与分布式计算原理"><a href="#并行计算与分布式计算原理" class="headerlink" title="并行计算与分布式计算原理"></a>并行计算与分布式计算原理</h1><p><em>深入理解云计算——基本原理和应用程序编程技术，第二章</em></p>
<!-- MarkdownTOC -->
<ul>
<li><a href="#并行计算和分布式计算">并行计算和分布式计算</a></li>
<li><a href="#并行计算基本要素">并行计算基本要素</a><ul>
<li><a href="#什么是并行处理">什么是并行处理</a></li>
<li><a href="#并行处理硬件架构">并行处理硬件架构</a></li>
<li><a href="#并行编程方法">并行编程方法</a></li>
<li><a href="#并行性的级别">并行性的级别</a></li>
<li><a href="#注意事项">注意事项</a></li>
</ul>
</li>
<li><a href="#分布式计算基本要素">分布式计算基本要素</a><ul>
<li><a href="#通用概念和定义">通用概念和定义</a></li>
<li><a href="#分布式系统组件">分布式系统组件</a></li>
<li><a href="#分布式计算架构模式">分布式计算架构模式</a></li>
<li><a href="#进程间通信模型">进程间通信模型</a></li>
</ul>
</li>
<li><a href="#分布式计算技术">分布式计算技术</a></li>
</ul>
<!-- /MarkdownTOC -->
<p><a name="并行计算和分布式计算"></a></p>
<h2 id="并行计算和分布式计算"><a href="#并行计算和分布式计算" class="headerlink" title="并行计算和分布式计算"></a>并行计算和分布式计算</h2><p>并行计算和分布式计算存在细微差别。并行代表一类紧耦合系统，分布式代表更更广泛的一类系统，包括紧耦合系统。</p>
<p><strong>并行计算</strong>指将计算任务分配给几个共享相同内存的处理器的计算模式。并行计算系统的架构通常表现为组件的同构性：每个处理器都是相同类型的，且拥有相同的处理性能。共享内存有一个独立的地址空间，可供所有处理器访问。并行程序被分成若干执行单元并分配给不同的处理器，它们之间依靠共享内存相互通信。</p>
<p><strong>分布式计算</strong>指哪些将计算任务进行划分，并在不同计算单元中同时执行的架构或系统，不论计算单元是不同节点上的处理器，或是同一计算机上的处理器，再或是同一处理器中的内核。相比并行计算，分布式计算包含的系统和应用程序的范围更广，是更为通用的概念。分布式这一术语通常以为着计算单元的位置不同，且这些单元在硬件和软件功能上也可能各不相同。典型的分布式系统实例是计算网格或互谅网计算系统，分布式系统再全球范围内集成各种架构、系统和应用。</p>
<p><a name="并行计算基本要素"></a></p>
<h2 id="并行计算基本要素"><a href="#并行计算基本要素" class="headerlink" title="并行计算基本要素"></a>并行计算基本要素</h2><p><a name="什么是并行处理"></a></p>
<h3 id="什么是并行处理"><a href="#什么是并行处理" class="headerlink" title="什么是并行处理"></a>什么是并行处理</h3><p>同时在多个处理器上处理多个任务成为<strong>并行处理</strong>。并行程序由多个活跃进程（任务）组成，同时解决给定的问题。运用分治法将一个给定的任务分为多个子任务，每个子任务在不同的中央处理器（CPU）中进行处理。运用分治法在多处理器系统上编程称作<strong>并行编程</strong>。</p>
<p>历史背景和推动技术<br>…</p>
<p><a name="并行处理硬件架构"></a></p>
<h3 id="并行处理硬件架构"><a href="#并行处理硬件架构" class="headerlink" title="并行处理硬件架构"></a>并行处理硬件架构</h3><p>并行处理的核心元素是CPU。根据可以同时处理的指令流和数据流的数量，计算机系统可以分为以下四类：</p>
<ul>
<li>单指令流单数据流（SISD）系统</li>
<li>单指令流多数据流（SIMD）系统</li>
<li>多指令流单数据流（MISD）系统</li>
<li>多指令流多数据流（MIMD）系统<ul>
<li>共享内存MIMD计算机</li>
<li>分布式内存MIMD计算机</li>
</ul>
</li>
</ul>
<p><a name="并行编程方法"></a></p>
<h3 id="并行编程方法"><a href="#并行编程方法" class="headerlink" title="并行编程方法"></a>并行编程方法</h3><p>顺序程序运行在单个处理器上且有单一控制线程。为了让几个处理器共同处理同一程序，就必须将该程序分成更小的、独立的块，这样每个处理器只需处理单独的一小块程序。以这种方式分解的程序就是并行程序。</p>
<p>并行程序设计有多种方法，最著名的几种是：</p>
<ul>
<li>数据并行</li>
<li>处理并行</li>
<li>“农场主和工作者”模式</li>
</ul>
<p><a name="并行性的级别"></a></p>
<h3 id="并行性的级别"><a href="#并行性的级别" class="headerlink" title="并行性的级别"></a>并行性的级别</h3><table>
<thead>
<tr>
<th><em>颗粒大小</em></th>
<th><em>代码</em></th>
<th><em>并行化执行者</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>大</td>
<td>独立的或重量级进程</td>
<td>程序设计员</td>
</tr>
<tr>
<td>中</td>
<td>函数或过程</td>
<td>程序设计员</td>
</tr>
<tr>
<td>小</td>
<td>循环或指令块</td>
<td>并行编译器</td>
</tr>
<tr>
<td>极小</td>
<td>指令</td>
<td>处理器</td>
</tr>
</tbody>
</table>
<p><a name="注意事项"></a></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>例如，对于给定的n个处理器，用户希望速度也增加n倍，但这只是理想情况，由于通信开销而不太可能实现。</p>
<p>两个重要原则</p>
<ul>
<li>计算速度和系统成本的平方根成反比</li>
<li>并行计算速度和处理器数量成对数冠以（y=klog(N)）</li>
</ul>
<p><a name="分布式计算基本要素"></a></p>
<h2 id="分布式计算基本要素"><a href="#分布式计算基本要素" class="headerlink" title="分布式计算基本要素"></a>分布式计算基本要素</h2><p><a name="通用概念和定义"></a></p>
<h3 id="通用概念和定义"><a href="#通用概念和定义" class="headerlink" title="通用概念和定义"></a>通用概念和定义</h3><p>分布式计算主要研究用于构建和管理分布式系统的模型、架构和算法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分布式系统是独立计算机的集合，对于用户来说是一个整体系统。</span><br></pre></td></tr></table></figure>
<p>该定义大致包括了多种类型的分布式计算系统，这些系统统一使用和集成分布式资源。本章重点讲解将多个独立计算机转化为整体系统的架构模型。通信是分布式计算的基础之一。由于分布式系统由协同工作的多个计算机组成，所以有必要利用网络实现多计算机之间的数据和信息交换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分布式系统组件位于仅能通过传递消息来通信和协调活动的网络计算机中。</span><br></pre></td></tr></table></figure>
<p><a name="分布式系统组件"></a></p>
<h3 id="分布式系统组件"><a href="#分布式系统组件" class="headerlink" title="分布式系统组件"></a>分布式系统组件</h3><p>分布式系统是从硬件到软件的整个计算层次模型中多个组件交互的结果。许多组件协同工作，为用户呈现出一个单一的整体系统。</p>
<p>在底层，计算机和网络硬件构成了物理基础设置，这些组件由操作系统直接管理。操作系统负责提供基础服务，用于进程间通信、进程调度和管理、文件系统和本地设备的资源管理。将网络和计算机这两层合并为一个平台，在这个平台上配置特定软件，便可将联网计算机组成一个分布式系统。</p>
<p>将公认的标准应用到操作系统层甚至硬件网络层中，利用异构组件可以很容易地构造一个统一的集成系统。例如，不同设备之间的网络连接由协议进行控制，实现设备无缝执行交互。在操作系统层，进程间通信服务在标准化通信协议下执行，例如TCP/IP协议、UDP协议等。</p>
<p>中间件层利用这些服务构建了一个开发和部署分布式应用程序的统一环境。这一层支持分布式系统的编程范式，我们将在本书第5~7章进行描述。依靠操作系统提供的服务，中间件层可开发协议、数据格式以及用于开发分布式应用程序的编程语言和框架。这些为分布式应用程序开发人员提供了同一接口，完全独立于底层操作系统且屏蔽了底层的异构性。</p>
<p><a name="分布式计算架构模式"></a></p>
<h3 id="分布式计算架构模式"><a href="#分布式计算架构模式" class="headerlink" title="分布式计算架构模式"></a>分布式计算架构模式</h3><p>尽管分布式系统包含若干层之间的交互，但只有中间件层才能够进行分布式计算，因为中间件层为应用提供了同一的整体运行环境。可采用多种不同的方式来组织组件，整合并购成分布式计算系统。这些组件之间的交互以及组件的职责决定了中间件的结构和类型，话句话说，也就是定义了中间件架构。了解架构模式有助于从整体上理解和划分软件系统结构，尤其是分布式计算结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">架构模式组要用于决定组件和连接器，组件、连接器以及结合条件一起作为架构模式的实例。</span><br></pre></td></tr></table></figure>
<p>架构模式分为两大类：</p>
<ul>
<li>软件架构模式</li>
<li>系统架构模式</li>
</ul>
<p>第一类与软件的逻辑结构有关，第二类包括从组件方面描述分布式软件系统物理结构的所有方式。</p>
<h4 id="组件和连接器"><a href="#组件和连接器" class="headerlink" title="组件和连接器"></a>组件和连接器</h4><p><em>组件</em>代表一个封装了系统的功能或特性的软件单元。组件实例可以是程序、对象、进程、管道或过滤器。连接器是一种允许组件之间进行合作和协调的通信机制。与组件不同的是，连接器不封装在单一实体中，而是以分布式方式由多个系统组件实现。</p>
<h4 id="软件架构模式"><a href="#软件架构模式" class="headerlink" title="软件架构模式"></a>软件架构模式</h4><table>
<thead>
<tr>
<th><em>种类</em></th>
<th><em>最常用的架构模式</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>数据中心</td>
<td>仓库<br>黑板</td>
</tr>
<tr>
<td>数据流</td>
<td>管道和过滤器<br>顺序批处理</td>
</tr>
<tr>
<td>虚拟机</td>
<td>基于规则的系统<br>解释器</td>
</tr>
<tr>
<td>调用和返回</td>
<td>主程序和子程序调用/自上而下的系统<br>面向对象系统<br>分层系统</td>
</tr>
<tr>
<td>独立组件</td>
<td>通信系统<br>事件系统</td>
</tr>
</tbody>
</table>
<h4 id="系统架构模式"><a href="#系统架构模式" class="headerlink" title="系统架构模式"></a>系统架构模式</h4><ul>
<li><p>客户端/服务器</p>
</li>
<li><p>对等</p>
</li>
</ul>
<p><a name="进程间通信模型"></a></p>
<h3 id="进程间通信模型"><a href="#进程间通信模型" class="headerlink" title="进程间通信模型"></a>进程间通信模型</h3><p>分布式系统由一组通过网络连接的、交互的并发进程组成。因此，进程间通信（IPC）是分布式系统设计和实现的基础。IPC既用于交换数据和信息，也用于协调进程活动。IPC将分布式系统的不同组件连接起来，使其成为一个系统。</p>
<h4 id="基于消息的通信"><a href="#基于消息的通信" class="headerlink" title="基于消息的通信"></a>基于消息的通信</h4><ul>
<li>消息传递<br>  MPI，OpenMP</li>
<li>远程过程调用<br>  RPC</li>
<li>分布式对象<br>  RPC模型基于面向对象范式的实现，将方法的远程调用看做对象。CORBA,COM，DCOM,COM+,RMI,.net</li>
<li>分布式代理和活动对象</li>
<li>web服务<br>  SOAP,REST</li>
</ul>
<h4 id="基于消息的通信模型"><a href="#基于消息的通信模型" class="headerlink" title="基于消息的通信模型"></a>基于消息的通信模型</h4><ul>
<li>点对点消息模型</li>
<li>发布和订阅消息模型</li>
<li>请求-应答消息模型</li>
</ul>
<p><a name="分布式计算技术"></a></p>
<h2 id="分布式计算技术"><a href="#分布式计算技术" class="headerlink" title="分布式计算技术"></a>分布式计算技术</h2>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-01T07:43:47.727Z"><a href="/blog/2016/04/01/Django(1) 安装和使用/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/Django(1) 安装和使用/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Django-1-安装和使用"><a href="#Django-1-安装和使用" class="headerlink" title="Django(1) 安装和使用"></a>Django(1) 安装和使用</h1><h2 id="Django-安装"><a href="#Django-安装" class="headerlink" title="Django 安装"></a>Django 安装</h2><p><code>easy_install django</code>即可</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="打开web服务器"><a href="#打开web服务器" class="headerlink" title="打开web服务器"></a>打开web服务器</h3><p>1.在cmd中输入<code>c:\Python34\Scripts\django-admin.exe startproject mysite</code></p>
<blockquote>
<p>project mysite会包含以下文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.py</span><br><span class="line">    mysite/</span><br><span class="line">        __init__.py</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        wsgi.py</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>manage.py:一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。 你可以在 django-admin.py and manage.py 中查看关于 manage.py 所有的细节。</li>
<li>mysite/__init__.py: 一个空文件，告诉 Python 该目录是一个 Python 包。</li>
<li>mysite/settings.py: 该 Django 项目的设置/配置。</li>
<li>mysite/urls.py: 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站“目录”。</li>
<li>mysite/wsgi.py: 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
</ul>
<p>2.开启服务器<br><code>python manage.py runserver</code> 可以在浏览器<code>http:\\127.0.0.1:8000</code>看到服务器已经打开<br>也可以通过<code>python manage.py runserver 8080</code>来指定端口</p>
<h3 id="有意义的事情（投票系统"><a href="#有意义的事情（投票系统" class="headerlink" title="有意义的事情（投票系统)"></a>有意义的事情（投票系统)</h3><p>1.数据库安装和设置(<a href="1">manual</a>)<br>下载<a href="2">sqlite下载页面</a>中<code>sqlite-shell-win32-XXX</code>和<code>sqlite-dll-win32-XXX</code>，并解压得到三个文件。利用命令<code>sqlite3 testDB.db</code>创建数据库。<br>在Django中配置sqlite3.<br>编辑mysite\settings.py中DATABASES中’default’以下值：</p>
<ul>
<li>ENGINE：从 ‘django.db.backends.postgresql_psycopg2’, ‘django.db.backends.mysql’, ‘django.db.backends.sqlite3’, ‘django.db.backends.oracle’ 中选一个</li>
<li>NAME：你的数据库名。如果你使用SQLite，该数据库将是你计算机上的一个文件；在这种情况下，:setting:NAME 将是一个完整的绝对路径，而且还包含该文件的名称。如果该文件不存在，它会在第一次同步数据库时自动创建（见下文）。</li>
<li>USER：你的数据库用户名（sqlite不需要）</li>
<li>PASSWORD: 你的数据库密码（sqlite不需要）</li>
<li>HOST: 你的数据库主机地址（sqlite不需要）</li>
</ul>
<p>默认情况下，:setting:INSTALLED_APPS 包含以下应用，这些都是由 Django 提供的：</p>
<ul>
<li>django.contrib.auth – 身份验证系统。</li>
<li>django.contrib.contenttypes – 内容类型框架。</li>
<li>django.contrib.sessions – session 框架。</li>
<li>django.contrib.sites – 网站管理框架。</li>
<li>django.contrib.messages – 消息框架。</li>
<li>django.contrib.staticfiles – 静态文件管理框架。<br>所有这些应用中每个应用至少使用一个数据库表，所以在使用它们之前我们需要创建数据库中的表。要做到这一点，请运行以下命令：<br><code>python manage.py migrate</code></li>
</ul>
<p>3.创建APP</p>
<p>在manage.py的同一个文件夹创建APP polls<code>python manage.py startapp polls</code>.polls 文件夹变成这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">polls/</span><br><span class="line">    __init__.py</span><br><span class="line">    admin.py</span><br><span class="line">    apps.py</span><br><span class="line">    migrations/</span><br><span class="line">        __init__.py</span><br><span class="line">    models.py</span><br><span class="line">    tests.py</span><br><span class="line">    views.py</span><br></pre></td></tr></table></figure>
<p>使得app能够被访问<br>在polls/urls.py中添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^$'</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在mysite/urls.py中添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>mysite中urls.py按照顺序进行正则匹配。匹配不包含域名和POST、GET等参数。具体查看re<br>模块。<br>一旦匹配成功，Django调用具体的view函数，并给予一个HttpRequest参数。<br>name值全局唯一，方便用来更改匹配方式。</p>
<p>4.建立模型</p>
<p>在投票系统中创建2个模型：Question和Choice。Question包括问题和发布日期。Choice包括选择和投票计数器。每个Choice都关联到一个Question.</p>
<p>实现这些功能需要在polls/models.py中添加下述代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>其中每一个模型都是django.db.models.Model的子类。每个模型都有一些类变量。每个类变量是Field的子类，代表数据库中一个字段。CharField代码字符变量，DateTimeField代表日期。一些类变量需要参数，这些参数不是在数据库中用到，而是在验证中使用。最后用ForeignKey来告诉Django Choice关联到一个Question. Django支持多对多，多对1,1对1等多种关联关系。</p>
<p>5.激活模型</p>
<p>添加APP到安装列表(直接在列表最后加入polls好像也没有问题)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span>,</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>然后运行<code>python manage.py makemigrations polls</code>告诉Django你对模型做了一些更改（这时是创建模型），改变被存储到migrate中。更改只是以文件的方式存储。根据更改需要对数据库进行相应的操作比如创建表等。就需要用到<code>python manage.py sqlmigrate polls 0001</code>.你会看到一些SQL语句。（这只是查看对应的SQL语句）。更改需要用到<code>python manage.py migrate</code>.(另外可以通过python manage.py check查看数据库是否有错。)。</p>
<p>migrations提供强大的功能：实时更改模型而不用担心数据库的数据不一致，也不需要重新删除在添加数据库。<br>修改模型的3步：</p>
<ul>
<li>在models.py中修改模型</li>
<li><code>python manage.py makemigrations</code> 根据修改建立migrations</li>
<li><code>python manage.py migrate</code> 应用修改到数据库</li>
</ul>
<h4 id="修改模块：添加显示功能"><a href="#修改模块：添加显示功能" class="headerlink" title="修改模块：添加显示功能"></a>修改模块：添加显示功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.utils.encoding <span class="keyword">import</span> python_2_unicode_compatible</span><br><span class="line"></span><br><span class="line"><span class="meta">@python_2_unicode_compatible  # only if you need to support Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line"><span class="meta">@python_2_unicode_compatible  # only if you need to support Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br></pre></td></tr></table></figure>
<h4 id="添加自定义方法"><a href="#添加自定义方法" class="headerlink" title="添加自定义方法"></a>添加自定义方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pub_date &gt;= timezone.now() - datetime.timedelta(days=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>6.创建admin</p>
<p>利用命令<code>python manage.py createsuperuser</code>创建admin用户。<code>python manage.py runserver</code>后，打开<a href="http://127.0.0.1:8000/admin/.进去后你可以看到可以修改的Groups和Users.这部分由django.contrib.auth认证框架提供。" target="_blank" rel="external">http://127.0.0.1:8000/admin/.进去后你可以看到可以修改的Groups和Users.这部分由django.contrib.auth认证框架提供。</a></p>
<p>7.注册polls(让polls app可以在网页中修改。)</p>
<p>在polls/admin.py中添加<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-01T06:50:13.502Z"><a href="/blog/2016/04/01/hello-world/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/hello-world/">Hello World</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-03-31T16:00:00.000Z"><a href="/blog/2016/04/01/网站访问记录/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/网站访问记录/">网站访问记录</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="网站访问记录"><a href="#网站访问记录" class="headerlink" title="网站访问记录"></a>网站访问记录</h1><h2 id="1-记录访问的时间，ip，次数。"><a href="#1-记录访问的时间，ip，次数。" class="headerlink" title="1.记录访问的时间，ip，次数。"></a>1.记录访问的时间，ip，次数。</h2><h2 id="2-画图"><a href="#2-画图" class="headerlink" title="2.画图"></a>2.画图</h2><h2 id="3-可视化"><a href="#3-可视化" class="headerlink" title="3.可视化"></a>3.可视化</h2>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-03-31T16:00:00.000Z"><a href="/blog/2016/04/01/c++学习文档/">2016-04-01</a></time>
      
      
  
    <h1 class="title"><a href="/blog/2016/04/01/c++学习文档/">c++ 学习文档</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="c-学习文档"><a href="#c-学习文档" class="headerlink" title="c++ 学习文档"></a>c++ 学习文档</h1><p><em>C++Primer中文版（第四版）</em></p>
<h2 id="第二章-变量和基本类型"><a href="#第二章-变量和基本类型" class="headerlink" title="第二章-变量和基本类型"></a>第二章-变量和基本类型</h2><h3 id="基本内置类型"><a href="#基本内置类型" class="headerlink" title="基本内置类型"></a>基本内置类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>含义</th>
<th>最小存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool</td>
<td>布尔型</td>
<td>-</td>
</tr>
<tr>
<td>char</td>
<td>字符型</td>
<td>8位</td>
</tr>
<tr>
<td>wchar_t</td>
<td>宽字符型</td>
<td>16位</td>
</tr>
<tr>
<td>short</td>
<td>短整型</td>
<td>16位</td>
</tr>
<tr>
<td>int</td>
<td>整型</td>
<td>16位</td>
</tr>
<tr>
<td>long</td>
<td>长整型</td>
<td>32位</td>
</tr>
<tr>
<td>float</td>
<td>单精度浮点型</td>
<td>6位有效数字</td>
</tr>
<tr>
<td>double</td>
<td>双精度浮点型</td>
<td>10位有效数字</td>
</tr>
<tr>
<td>long double</td>
<td>扩展精度浮点型</td>
<td>10位有效数字</td>
</tr>
</tbody>
</table>
<h4 id="字面值常量表示方式"><a href="#字面值常量表示方式" class="headerlink" title="字面值常量表示方式"></a>字面值常量表示方式</h4><p>10,8,16进制表示方式.以0开头的常量表示8进制，以0x或0X开头的表示十六进制。字面值整数常量的类型默认为int或long。其精度类型决定于字面值。通过增加后缀，能够强制将字面值整数常量转换为long,unsigned,unsigned long类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">20 // decimal</span><br><span class="line">024 // octal</span><br><span class="line">0x14 // hexdecimal</span><br><span class="line"></span><br><span class="line">128u /* unsigned */  1024UL /* unsigned long */</span><br><span class="line">1L /* long*/ 8Lu /* unsigned long*/</span><br></pre></td></tr></table></figure>
<p>通常可以用十进制或者科学计数法来表示浮点字面值常量。指数用E或e表示，默认为double。在数值后加上F或f表示单精度。加上L或l表示扩展精度（不提倡使用l,因为和1很像）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3.14159F .001f 12.345L 0.</span><br><span class="line">3.14159E0f 1E-3F 1.2345E1L 0e0</span><br></pre></td></tr></table></figure>
<p>布尔用true和false。字符型用单引号。不可打印的可以用转义字符。也可以用通用转义字符\ooo(3个8进制数字).16进制表示为\xddd</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>变量提供了程序可以操作的有名字的存储区。C++程序员常把变量称为”变量”</p>
<p>C++两种表达式：左值（可以出现在赋值语句左边和右边）和右值（只能出现在赋值语句右边）。</p>
<p>对象就是内存中具有类型的区域。计算左值表达式就会产生对象。</p>
<p>变量名，即变量的标识符，可以由字符、数字和下划线组成。变量名必须以字母或下划线开头，并且区分大小写字母。变量名不应该太长。</p>
<p>变量命名习惯</p>
<ul>
<li>变量名一般用小写字母。</li>
<li>标识符应该使用能够帮助记忆的名字</li>
<li>2中风格。student_loan 或 studenLoan</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/blog/" class="alignleft prev">Vorherige Seite</a>
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Suche">
    <input type="hidden" name="q" value="site:mrgao1008.github.io/blog">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/blog/tags/c/">c++</a><small>1</small></li>
  
    <li><a href="/blog/tags/site/">site</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 mrgao1008@gmail.com
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/blog/js/jquery.imagesloaded.min.js"></script>
<script src="/blog/js/gallery.js"></script>




<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
